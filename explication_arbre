407073@ppti-14-303-14:/users/nfs/Etu3/3407073/Documents/2I013/mon_repo_git$ ipython
Python 2.7.9 (default, Mar  1 2015, 12:57:24) 
Type "copyright", "credits" or "license" for more information.

IPython 4.0.2 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object', use 'object??' for extra details.

In [1]: %paste

from soccersimulator import settings,SoccerTeam, Simulation, show_simu, KeyboardStrategy
from soccersimulator import Strategy, SoccerAction, Vector2D, load_jsonz,dump_jsonz,Vector2D
import logging
from arbres_utils import build_apprentissage,affiche_arbre,DTreeStrategy,apprend_arbre,genere_dot
from sklearn.tree       import export_graphviz
from sklearn.tree import DecisionTreeClassifier
import os.path
## Strategie aleatoire
class FonceStrategy(Strategy):
    def __init__(self):
        super(FonceStrategy,self).__init__("Fonce")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction(state.ball.position-state.player_state(id_team,id_player).position,\
                Vector2D((2-id_team)*settings.GAME_WIDTH,settings.GAME_HEIGHT/2.)-state.ball.position)

class StaticStrategy(Strategy):
    def __init__(self):
        super(StaticStrategy,self).__init__("Static")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction()

#######
## Constructioon des equipes
#######

team1 = SoccerTeam("team1")
strat_j1 = KeyboardStrategy()
strat_j1.add('a',FonceStrategy())
strat_j1.add('z',StaticStrategy())
team1.add("Jexp 1",strat_j1)
team1.add("Jexp 2",StaticStrategy())
team2 = SoccerTeam("team2")
team2.add("rien 1", StaticStrategy())
team2.add("rien 2", StaticStrategy())
## -- End pasted text --
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-f66c03468dcb> in <module>()
      2 from soccersimulator import Strategy, SoccerAction, Vector2D, load_jsonz,dump_jsonz,Vector2D
      3 import logging
----> 4 from arbres_utils import build_apprentissage,affiche_arbre,DTreeStrategy,apprend_arbre,genere_dot
      5 from sklearn.tree       import export_graphviz
      6 from sklearn.tree import DecisionTreeClassifier

/users/nfs/Etu3/3407073/Documents/2I013/mon_repo_git/arbres_utils.py in <module>()
      7 logger = logging.getLogger("arbrestrategie")
      8 
----> 9 assert sklearn.__version__ == "0.18.1","Updater sklearn !! (pip install -U sklearn --user )"
     10 
     11 

AssertionError: Updater sklearn !! (pip install -U sklearn --user )

In [2]: 

In [2]: ls
arbres_dec.py     __init__.pyc     projet                test.py
arbres_utils.py   LancerSimu.py    simple_example.py     tools.py
arbres_utils.pyc  LancerSimu.pyc   Strategie_de_base.py  tools.pyc
exemple.py        observer.py      StrategiesCreees.py   version_lun12.py
__init__.py       probleme_projet  StrategiesCreees.pyc

In [3]: %paste

from soccersimulator import settings,SoccerTeam, Simulation, show_simu, KeyboardStrategy
from soccersimulator import Strategy, SoccerAction, Vector2D, load_jsonz,dump_jsonz,Vector2D
import logging
from arbres_utils import build_apprentissage,affiche_arbre,DTreeStrategy,apprend_arbre,genere_dot
from sklearn.tree       import export_graphviz
from sklearn.tree import DecisionTreeClassifier
import os.path
## Strategie aleatoire
class FonceStrategy(Strategy):
    def __init__(self):
        super(FonceStrategy,self).__init__("Fonce")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction(state.ball.position-state.player_state(id_team,id_player).position,\
                Vector2D((2-id_team)*settings.GAME_WIDTH,settings.GAME_HEIGHT/2.)-state.ball.position)

class StaticStrategy(Strategy):
    def __init__(self):
        super(StaticStrategy,self).__init__("Static")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction()

#######
## Constructioon des equipes
#######

team1 = SoccerTeam("team1")
strat_j1 = KeyboardStrategy()
strat_j1.add('a',FonceStrategy())
strat_j1.add('z',StaticStrategy())
team1.add("Jexp 1",strat_j1)
team1.add("Jexp 2",StaticStrategy())
team2 = SoccerTeam("team2")
team2.add("rien 1", StaticStrategy())
team2.add("rien 2", StaticStrategy())
## -- End pasted text --
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-3-f66c03468dcb> in <module>()
      2 from soccersimulator import Strategy, SoccerAction, Vector2D, load_jsonz,dump_jsonz,Vector2D
      3 import logging
----> 4 from arbres_utils import build_apprentissage,affiche_arbre,DTreeStrategy,apprend_arbre,genere_dot
      5 from sklearn.tree       import export_graphviz
      6 from sklearn.tree import DecisionTreeClassifier

/users/nfs/Etu3/3407073/Documents/2I013/mon_repo_git/arbres_utils.py in <module>()
      7 logger = logging.getLogger("arbrestrategie")
      8 
----> 9 assert sklearn.__version__ == "0.18.1","Updater sklearn !! (pip install -U sklearn --user )"
     10 
     11 

AssertionError: Updater sklearn !! (pip install -U sklearn --user )

In [4]: 
Do you really want to exit ([y]/n)? y
3407073@ppti-14-303-14:/users/nfs/Etu3/3407073/Documents/2I013/mon_repo_git$ ipython
Python 2.7.9 (default, Mar  1 2015, 12:57:24) 
Type "copyright", "credits" or "license" for more information.

IPython 4.0.2 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object', use 'object??' for extra details.

In [1]: %paste

from soccersimulator import settings,SoccerTeam, Simulation, show_simu, KeyboardStrategy
from soccersimulator import Strategy, SoccerAction, Vector2D, load_jsonz,dump_jsonz,Vector2D
import logging
from arbres_utils import build_apprentissage,affiche_arbre,DTreeStrategy,apprend_arbre,genere_dot
from sklearn.tree       import export_graphviz
from sklearn.tree import DecisionTreeClassifier
import os.path
## Strategie aleatoire
class FonceStrategy(Strategy):
    def __init__(self):
        super(FonceStrategy,self).__init__("Fonce")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction(state.ball.position-state.player_state(id_team,id_player).position,\
                Vector2D((2-id_team)*settings.GAME_WIDTH,settings.GAME_HEIGHT/2.)-state.ball.position)

class StaticStrategy(Strategy):
    def __init__(self):
        super(StaticStrategy,self).__init__("Static")
    def compute_strategy(self,state,id_team,id_player):
        return SoccerAction()

#######
## Constructioon des equipes
#######

team1 = SoccerTeam("team1")
strat_j1 = KeyboardStrategy()
strat_j1.add('a',FonceStrategy())
strat_j1.add('z',StaticStrategy())
team1.add("Jexp 1",strat_j1)
team1.add("Jexp 2",StaticStrategy())
team2 = SoccerTeam("team2")
team2.add("rien 1", StaticStrategy())
team2.add("rien 2", StaticStrategy())
## -- End pasted text --
Out[1]: team2(): rien 1 (Static) rien 2 (Static)

In [2]: %paste
simu = Simulation(team1,team2)
show_simu(simu)
## -- End pasted text --
  File "<ipython-input-2-cdcec1927c25>", line 2
    show_simu(simu)
    ^
IndentationError: unexpected indent


In [3]: %paste
    simu = Simulation(team1,team2)
    show_simu(simu)
## -- End pasted text --

In [4]: strat_j1.states
Out[4]: 
[(Step: 62, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (70.773326,43.414997), vit: (0.187266,0.070225), action:Acc:(0.187266,0.070225), Shoot:(6.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
  (1, 0, 'Fonce')),
 (Step: 85, Ball: pos: (127.238740,45.262560), vit: (1.131767,0.005688) (1,0):pos: (93.348336,46.218060), vit: (0.199915,-0.005828), action:Acc:(0.199915,-0.005828), Shoot:(5.999653,-0.064502), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
  (1, 0, 'Static')),
 (Step: 158, Ball: pos: (143.176407,45.342665), vit: (0.010305,0.000052) (1,0):pos: (103.340921,45.979479), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
  (1, 0, 'Fonce')),
 (Step: 209, Ball: pos: (143.330827,45.343442), vit: (0.000438,0.000002) (1,0):pos: (143.990087,45.333120), vit: (-0.199975,0.003142), action:Acc:(-0.199975,0.003142), Shoot:(5.992061,-0.308550), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
  (1, 0, 'Static')),
 (Step: 270, Ball: pos: (143.337536,45.343475), vit: (0.000010,0.000000) (1,0):pos: (136.916441,45.444555), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
  (1, 0, 'Fonce')),
 (Step: 300, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (26.765854,26.912195), vit: (0.187266,0.070225), action:Acc:(0.187266,0.070225), Shoot:(6.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 1-0,
  (1, 0, 'Static')),
 (Step: 329, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (35.688123,30.258046), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 1-0,
  (1, 0, 'Fonce')),
 (Step: 350, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (52.365706,36.512140), vit: (0.187266,0.070225), action:Acc:(0.187266,0.070225), Shoot:(6.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 1-0,
  (1, 0, 'Static')),
 (Step: 367, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (60.167465,39.437799), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 1-0,
  (1, 0, 'Fonce')),
 (Step: 407, Ball: pos: (113.975019,40.456534), vit: (1.086625,-0.126672) (1,0):pos: (88.910738,42.923962), vit: (0.199037,-0.019608), action:Acc:(0.199037,-0.019608), Shoot:(5.957953,0.709079), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 1-0,
  (1, 0, 'Static'))]


In [5]: %paste

### Transformation d'un etat en features : state,idt,idp -> R^d
def my_get_features(state,idt,idp):
    """ extraction du vecteur de features d'un etat, ici distance a la balle, distance au but, distance balle but """
    p_pos= state.player_state(idt,idp).position
    f1 = p_pos.distance(state.ball.position)
    f2= p_pos.distance( Vector2D((2-idt)*settings.GAME_WIDTH,settings.GAME_HEIGHT/2.))
    f3 = state.ball.position.distance(Vector2D((2-idt)*settings.GAME_WIDTH,settings.GAME_HEIGHT/2.))
    return [f1,f2,f3]
## -- End pasted text --

In [6]: s = strat_j1.sta
strat_j1.state   strat_j1.states  

In [6]: s = strat_j1.states[0]

In [7]: s
Out[7]: 
(Step: 62, Ball: pos: (75.000000,45.000000), vit: (0.000000,0.000000) (1,0):pos: (70.773326,43.414997), vit: (0.187266,0.070225), action:Acc:(0.187266,0.070225), Shoot:(6.000000,0.000000), Name: (1,1):pos: (15.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,0):pos: (135.000000,22.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: (2,1):pos: (135.000000,67.500000), vit: (0.000000,0.000000), action:Acc:(0.000000,0.000000), Shoot:(0.000000,0.000000), Name: score : 0-0,
 (1, 0, 'Fonce'))

In [8]: my_get_features(s[0],s[1][0],s[1][1])
Out[8]: [4.514090089881471, 79.24252739873496, 75.0]


In [9]: dx,dy = build_apprentissage(strat_j1.states,my_get_features)

In [10]: dx
Out[10]: 
array([[   4.51409009,   79.2425274 ,   75.        ],
       [  33.90387003,   56.6647567 ,   22.76277475],
       [  39.8405755 ,   46.66935866,    6.83219183],
       [   0.65934086,    6.01913809,    6.6780103 ],
       [   6.4218904 ,   13.09110915,    6.67131175],
       [  51.51409009,  124.55449939,   75.        ],
       [  41.98510296,  115.25853725,   75.        ],
       [  24.17343609,   98.0025461 ,   75.        ],
       [  15.84115426,   90.00456882,   75.        ],
       [  25.18543969,   61.12452771,   36.31036172]])

In [11]: dy
Out[11]: 
array(['Fonce', 'Static', 'Fonce', 'Static', 'Fonce', 'Static', 'Fonce',
       'Static', 'Fonce', 'Static'], 
      dtype='|S6')

In [12]: dt = apprend_arbre(dx,dy)

In [13]: dt.pred
dt.predict            dt.predict_log_proba  dt.predict_proba

In [13]: dt.predict(dx[0])
/users/Etu3/3407073/.local/lib/python2.7/site-packages/sklearn/utils/validation.py:395: DeprecationWarning: Passing 1d arrays as data is deprecated in 0.17 and will raise ValueError in 0.19. Reshape your data either using X.reshape(-1, 1) if your data has a single feature or X.reshape(1, -1) if it contains a single sample.
  DeprecationWarning)
Out[13]: 
array(['Fonce'], 
      dtype='|S6')

In [14]: affiche_arbre(dt)
Out[14]: '|---------X0<=20.01\n|         |---------X2<=40.84\n|         |         |---------(Fonce: 1, Static: 1)\n|         |---------X2>40.84\n|                   |---------(Fonce: 2, Static: 0)\n|---------X0>20.01\n          |---------X0<=36.87\n          |         |---------(Fonce: 0, Static: 3)\n          |---------X0>36.87\n                    |---------(Fonce: 2, Static: 1)\n'

In [15]: print(affiche_arbre(dt))
|---------X0<=20.01
|         |---------X2<=40.84
|         |         |---------(Fonce: 1, Static: 1)
|         |---------X2>40.84
|                   |---------(Fonce: 2, Static: 0)
|---------X0>20.01
          |---------X0<=36.87
          |         |---------(Fonce: 0, Static: 3)
          |---------X0>36.87
                    |---------(Fonce: 2, Static: 1)


In [16]:     genere_dot(dt,"test_arbre.dot")
Use dot -Tpdf test_arbre.dot test_arbre..pdf to generate pdf

In [17]: 


la veille 

startegie 
intro =organisation des classes
description des strategie 
rapport sur git 
!= strategies
5 slides 
